{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/main.js"],"names":["checkFeatures","window","navigator","serviceWorker","register","scope","Alert","el","document","querySelector","setContent","content","Array","isArray","this","clear","f","createDocumentFragment","forEach","appendChild","btn","createElement","setAttribute","classList","add","textContent","firstChild","removeChild","initialize","_this","addEventListener","e","target","contains","preventDefault","key","getAttribute","Manager","deleteCharacter","p","backup_dialog","reset","remove","input_file","console","log","files","length","from","reader","FileReader","onload","theFile","restoreCharacter","result","readAsText","input","value","action_menu","action_opener","style","overflow","toggle","getComputedStyle","getPropertyValue","action_btn_backup","Blob","display","downloadBackup","action_btn_email","emailBackup","action_btn_save","saveCharacter","action_btn_new","location","hash","generateKey","action_btn_restore","action_btn_load","currentTarget","nextElementSibling","LoadMenu","open","close","addCharacter","data","Storage","get","JSON","parse","existing","charname","charclass","level","li","a","del","innerHTML","message","removeCharacter","loadlink","parentNode","isEmpty","_this2","body","closest","id","deletePrompt","attribute_fields","querySelectorAll","attribute_saves","skill_checks","dialog_unsaved","calcAttrMod","val","raw","Math","floor","calcSaveMod","attr","prof","attr_field","attr_mod","save_mod","checked","parseInt","calcSkillMod","skill_checked","attribute","mod_field","innerText","before","removeAttribute","field","skills","character_model","app","race","background","alignment","experience","inspiration","proficiency","armor_class","speed","hp_cur","hp_max","hd_cur","hd_max","str","dex","con","intel","wis","cha","saves","acrobatics","animal_handling","arcana","athletics","deception","history","insight","intimidation","investigation","medicine","nature","perception","performance","persuasion","religion","sleight_of_Hand","stealth","survival","weapons","proficiencies_other","languages","traits","ideals","bonds","flaws","equipment","cp","sp","gp","pp","features","notes","spell_ability","spell_save","spell_attack","spell_slots","1","2","3","4","5","6","7","8","9","spells","0","updated","txt","localStorage","getItem","set","setItem","removeItem","getAllKeys","keys","i","push","exports","manager","cur_character","characterJSON","obj","prop","stringify","currentTimestamp","d","Date","toUTCString","random","toString","slice","setCurCharacterData","_this3","_typeof","props","Object","changeCharacter","urlhash","substr","loadCharacter","json","create","renderCharacter","_this4","fields","subf","tagName","event","Event","dispatchEvent","_this5","hasOwnProperty","text","focus","select","file","type","url","URL","createObjectURL","href","download","click","setTimeout","revokeObjectURL","encodeURIComponent","trim","replace","char_obj","Error","h","p1","p4","p2","p3","dialog_help","getElementById","help_open"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\n/**\n * Confirm browser supports features we need\n * @return {boolean}\n */\nconst checkFeatures = function () {\n\tif ('localStorage' in window && window['localStorage'] !== null) {\n\t\t// Ok for localstorage\n\t} else {\n\t\treturn false;\n\t}\n};\n\nif ('serviceWorker' in navigator) {\n\tnavigator.serviceWorker.register('service_worker.js', {\n\t\tscope: '/'\n\t});\n}\n\n/**\n * Alert:\n * Main method for showing warnings and other interactions that need prominent placement/attention\n */\nconst Alert = {\n\t/**\n\t * The DOMElement for the alert\n\t */\n\tel: document.querySelector('.alert-main'),\n\t/**\n\t * Add content to alert\n\t * @param {Array|DOMElement} content single DOMElement or Array of DOMElements\n\t */\n\tsetContent: function (content) {\n\t\tif (!Array.isArray(content)) {\n\t\t\tcontent = [content];\n\t\t}\n\t\tthis.clear(); // make sure we start with an empty alert\n\t\tconst f = document.createDocumentFragment();\n\t\tcontent.forEach((el) => {\n\t\t\tf.appendChild(el);\n\t\t});\n\t\tconst btn = document.createElement('button');\n\t\tbtn.setAttribute('type', 'button');\n\t\tbtn.classList.add('close');\n\t\tbtn.textContent = 'Close';\n\t\tf.appendChild(btn);\n\t\tthis.el.appendChild(f);\n\t},\n\t/**\n\t * Clear the alert (which makes it disappear)\n\t */\n\tclear: function () {\n\t\twhile (this.el.firstChild) {\n\t\t\tthis.el.removeChild(this.el.firstChild);\n\t\t}\n\t},\n\t/**\n\t * Setup some events, etc.\n\t */\n\tinitialize: function () {\n\t\tthis.el.addEventListener('click', (e) => {\n\t\t\tif (e.target.classList.contains('close')) {\n\t\t\t\t// close button click\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.clear();\n\t\t\t} else if (e.target.classList.contains('delete-conf')) {\n\t\t\t\t// delete confirmation\n\t\t\t\tconst key = e.target.getAttribute('data-key');\n\t\t\t\tthis.clear();\n\t\t\t\tManager.deleteCharacter(key);\n\t\t\t}\n\t\t});\n\t}\n};\nAlert.initialize();\n\nif (checkFeatures() === false) {\n\t// display some kind of alert at the top of the page.\n\tconst p = document.createElement('p');\n\tp.textContent = `Sorry, your browser does not supported the required features for this app to work. Try using the latest Chrome or Firefox for best results.`;\n\tAlert.setContent(p);\n}\n\n/**\n * Restore backup dialog\n */\nconst backup_dialog = document.querySelector('.dialog-backup');\nbackup_dialog.querySelector('button[type=button]').addEventListener('click', (e) => {\n\tbackup_dialog.querySelector('form').reset();\n\tbackup_dialog.classList.remove('open');\n});\nbackup_dialog.querySelector('form').addEventListener('submit', (e) => {\n\te.preventDefault();\n\tconst input_file = e.target.querySelector('input[type=file]');\n\tconsole.log(input_file.files);\n\tif (input_file.files && input_file.files.length > 0) {\n\t\tArray.from(input_file.files).forEach((f) => {\n\t\t\tconst reader = new FileReader();\n\t\t\t// Closure to capture the file information.\n\t\t\treader.onload = (function (theFile) {\n\t\t\t\treturn function (e) {\n\t\t\t\t\tManager.restoreCharacter(e.target.result);\n\t\t\t\t};\n\t\t\t})(f);\n\t\t\treader.readAsText(f);\n\t\t});\n\t} else {\n\t\tconst input = e.target.querySelector('textarea');\n\t\tif (input.value === '') {\n\t\t\treturn;\n\t\t}\n\t\tManager.restoreCharacter(input.value);\n\t}\n\tbackup_dialog.classList.remove('open');\n\te.target.reset();\n});\n\n/**\n * Actions menu and button events\n */\nconst action_menu = document.querySelector('.app-actions');\nconst action_opener = document.querySelector('.btn-open-actions');\naction_opener.addEventListener('click', (e) => {\n\tif (action_menu.classList.contains('open')) {\n\t\t// set menu to hide overflow BEFORE it closes\n\t\taction_menu.style.overflow = 'hidden';\n\t}\n\taction_menu.classList.toggle('open');\n});\n/**\n * When the menu transitions to open we want to set overflow to visible so the Load dropdown can be visible\n */\naction_menu.addEventListener('transitionend', (e) => {\n\tconsole.log(e);\n\tconst style = window.getComputedStyle(action_menu);\n\tif (style.getPropertyValue('max-height') !== '0px') {\n\t\taction_menu.style.overflow = 'visible';\n\t}\n});\nconst action_btn_backup = action_menu.querySelector('.btn-file-backup');\nif (typeof window.Blob !== 'function') {\n\taction_btn_backup.style.display = 'none';\n}\naction_btn_backup.addEventListener('click', (e) => {\n\tManager.downloadBackup();\n});\nconst action_btn_email = action_menu.querySelector('.btn-email-backup');\naction_btn_email.addEventListener('click', (e) => {\n\tManager.emailBackup();\n});\nconst action_btn_save = action_menu.querySelector('.btn-save');\naction_btn_save.addEventListener('click', (e) => {\n\tManager.saveCharacter();\n});\nconst action_btn_new = action_menu.querySelector('.btn-new-character');\naction_btn_new.addEventListener('click', (e) => {\n\t// change hash to trigger new character?\n\twindow.location.hash = `#${Manager.generateKey()}`;\n});\nconst action_btn_restore = action_menu.querySelector('.btn-restore-backup');\naction_btn_restore.addEventListener('click', (e) => {\n\tbackup_dialog.classList.add('open');\n});\nconst action_btn_load = action_menu.querySelector('.btn-load');\naction_btn_load.addEventListener('click', (e) => {\n\te.currentTarget.nextElementSibling.classList.toggle('open');\n});\n\n/**\n * Load Menu\n */\nconst LoadMenu = {\n\t/**\n\t * DOMELement\n\t */\n\tel: document.querySelector('#character_list'),\n\t/**\n\t * Open menu\n\t */\n\topen: function () {\n\t\tthis.el.classList.add('open');\n\t},\n\t/**\n\t * Close menu\n\t */\n\tclose: function () {\n\t\tthis.el.classList.remove('open');\n\t},\n\t/**\n\t * Add character to list\n\t * @param {String} key\n\t */\n\taddCharacter: function (key) {\n\t\tlet data = Storage.get(key);\n\t\t\n\t\tif (data === '') {\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tdata = JSON.parse(data);\n\t\t\t\n\t\t\tif (data.key && data.key !== '') {\n\t\t\t\t// check if it's already there\n\t\t\t\tconst existing = this.el.querySelector(`a[href=\"#${data.key}\"]`);\n\t\t\t\tif (existing !== null) {\n\t\t\t\t\t// update the text as appropriate\n\t\t\t\t\texisting.textContent = `${data.charname} (${data.charclass} ${data.level})`;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst li = document.createElement('li');\n\t\t\t\tconst a = document.createElement('a');\n\t\t\t\ta.textContent = `${data.charname} (${data.charclass} ${data.level})`;\n\t\t\t\ta.setAttribute('href', `#${data.key}`);\n\t\t\t\tli.appendChild(a);\n\t\t\t\tconst del = document.createElement('a');\n\t\t\t\tdel.classList.add('delete');\n\t\t\t\tdel.innerHTML = '❌';\n\t\t\t\tdel.setAttribute('href', '#');\n\t\t\t\tdel.setAttribute('data-key', data.key);\n\t\t\t\tli.appendChild(del);\n\t\t\t\tthis.el.querySelector('#saved_characters').appendChild(li);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.log(e.message);\n\t\t}\n\t},\n\t/**\n\t * Remove character from list\n\t * @param {String} key\n\t */\n\tremoveCharacter: function (key) {\n\t\tconst loadlink = this.el.querySelector(`a[href=\"#${key}\"]`);\n\t\tconst li = loadlink.parentNode;\n\t\tli.parentNode.removeChild(li);\n\t},\n\t/**\n\t * Do we have any saved characters here?\n\t * @return {Boolean}\n\t */\n\tisEmpty: function () {\n\t\treturn this.el.querySelector('li') === null;\n\t},\n\t/**\n\t * Set up event handlers\n\t */\n\tinitialize: function () {\n\t\tdocument.body.addEventListener('click', (e) => {\n\t\t\tconst close = e.target.closest(`#${this.el.id}`);\n\t\t\tif (close === null) {\n\t\t\t\t// Ignore the load button (it's already handled elsewhere)\n\t\t\t\tif (e.target.classList.contains('btn-load')) { return; }\n\t\t\t\t// Hide the menus.\n\t\t\t\tthis.close();\n\t\t\t} else {\n\t\t\t\t// delete link in load menu\n\t\t\t\tif (e.target.classList.contains('delete')) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tconsole.log('delete!');\n\t\t\t\t\tManager.deletePrompt(e.target.getAttribute('data-key'));\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};\nLoadMenu.initialize();\n\n/**\n * Grab some arrays of DOM elements we might need multiple times\n */\nconst attribute_fields = Array.from(document.querySelectorAll('.pc-attributes input[type=number]'));\nconst attribute_saves = Array.from(document.querySelectorAll('.pc-attributes input[type=checkbox]'));\nconst skill_checks = Array.from(document.querySelectorAll('input[data-name=\"skills\"]'));\nconst dialog_unsaved = document.querySelector('.alert-unsaved');\n\n/**\n * Calculate the attribute modifier based on the score\n * @return {String|Number} 0, a negative number, or a positive number preceded by a +\n */\nconst calcAttrMod = function (val) {\n\tconst raw = Math.floor((val - 10) / 2);\n\treturn (raw > 0) ? `+${raw}` : raw;\n};\n/**\n * Calculate the save modifier based on the score, proficiency, and prof bonus\n * and set it\n * @param {String} attr attribute name\n */\nconst calcSaveMod = function (attr) {\n\tlet prof = 0;\n\tconst attr_field = document.querySelector(`[data-name=${attr}]`).parentNode;\n\tconst attr_mod = attr_field.querySelector('.pc-attribute-mod').innerHTML;\n\tconst save_mod = attr_field.querySelector('.pc-save-mod');\n\tconst checked = attr_field.querySelector('input[type=checkbox]').checked;\n\tif (checked) {\n\t\tprof = document.querySelector('[data-name=\"proficiency\"]').innerHTML;\n\t\tif (prof === '') {\n\t\t\tprof = 0;\n\t\t} else {\n\t\t\tprof = parseInt(prof, 10);\n\t\t}\n\t}\n\tconst raw = 0 + parseInt(prof, 10) + parseInt(attr_mod, 10);\n\tsave_mod.innerHTML = (raw > 0) ? `+${raw}` : raw;\n};\n/**\n * Calculate the modifier for a skill based on proficiency and attribute\n * @param {DOMElement} el the skill checkbox element\n */\nconst calcSkillMod = function (el) {\n\tconst skill_checked = el.checked;\n\tconst attribute = el.getAttribute('data-attr');\n\tconst mod_field = el.parentNode.nextElementSibling;\n\t\n\tlet prof = 0;\n\tif (skill_checked) {\n\t\tprof = document.querySelector('[data-name=\"proficiency\"]').innerHTML;\n\t\tif (prof === '') {\n\t\t\tprof = 0;\n\t\t} else {\n\t\t\tprof = parseInt(prof, 10);\n\t\t}\n\t}\n\tconst attr = document.querySelector(`[data-name=${attribute}]`);\n\tconst attr_mod = parseInt(calcAttrMod(attr.value), 10);\n\tconst raw = 0 + prof + attr_mod;\n\tmod_field.innerText = (raw > 0) ? `+${raw}` : raw;\n};\n\n/**\n * Event: Listen for contenteditable changes\n * delegate focus/blur from container (body didn't seem to work)\n * use a temporary data-before attribute to check for change\n */\ndocument.querySelector('.container').addEventListener('focus', (e) => {\n\tif (e.target.getAttribute('contenteditable') === 'true') {\n\t\te.target.setAttribute('data-before', e.target.innerHTML);\n\t}\n}, true);\ndocument.querySelector('.container').addEventListener('blur', (e) => {\n\tif (e.target.getAttribute('contenteditable') === 'true') {\n\t\tconst before = e.target.getAttribute('data-before');\n\t\tif (before !== e.target.innerHTML) {\n\t\t\tconsole.log('Changed');\n\t\t\te.target.removeAttribute('data-before');\n\t\t\tdialog_unsaved.classList.add('open');\n\t\t\t\n\t\t\t// if proficiency then update saves and skills\n\t\t\tif (e.target.getAttribute('data-name') === 'proficiency') {\n\t\t\t\tconst attribute_fields = Array.from(document.querySelectorAll('.pc-attributes input[type=number]'));\n\t\t\t\tattribute_fields.forEach((el) => {\n\t\t\t\t\tcalcSaveMod(el.getAttribute('data-name'));\n\t\t\t\t});\n\t\t\t\tconst skill_checks = Array.from(document.querySelectorAll('input[data-name=\"skills\"]'));\n\t\t\t\tskill_checks.forEach((el) => {\n\t\t\t\t\tcalcSkillMod(el);\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\t// Do something here... Save?\n\t\t}\n\t}\n}, true);\n/**\n * Event: When attributes change update the related modifier\n */\nattribute_fields.forEach((el) => {\n\tconst field = el.parentNode;\n\tconst mod_field = field.querySelector('.pc-attribute-mod');\n\tel.addEventListener('change', (e) => {\n\t\tmod_field.innerText = calcAttrMod(e.currentTarget.value);\n\t\tconst attr = el.getAttribute('data-name');\n\t\tcalcSaveMod(attr);\n\t\tconst skills = Array.from(document.querySelectorAll(`[data-attr=${attr}]`));\n\t\tskills.forEach((el) => {\n\t\t\tcalcSkillMod(el);\n\t\t});\n\t\tdialog_unsaved.classList.add('open');\n\t});\n});\n/**\n * Event: When save is checked recalc save mod\n */\nattribute_saves.forEach((el) => {\n\tel.addEventListener('change', (e) => {\n\t\tconst attr = e.currentTarget.getAttribute('data-subfield');\n\t\tcalcSaveMod(attr);\n\t\tdialog_unsaved.classList.add('open');\n\t});\n});\n/**\n * Event: When a skill is un/checked adjust the modifier\n */\nskill_checks.forEach((el) => {\n\tel.addEventListener('change', (e) => {\n\t\tconsole.log('check change');\n\t\tcalcSkillMod(e.currentTarget);\n\t\tdialog_unsaved.classList.add('open');\n\t});\n});\n\n/**\n * Model for character data\n */\nconst character_model = {\n\tapp: 'character-sheet-5e',\n\tkey: '',\n\tcharname: '',\n\tcharclass: '',\n\trace: '',\n\tbackground: '',\n\talignment: '',\n\tlevel: 1,\n\texperience: 0,\n\tinspiration: '',\n\tproficiency: '+2',\n\tarmor_class: 10,\n\tspeed: 30,\n\thp_cur: 0,\n\thp_max: 0,\n\thd_cur: 1,\n\thd_max: 1,\n\tstr: 10,\n\tdex: 10,\n\tcon: 10,\n\tintel: 10,\n\twis: 10,\n\tcha: 10,\n\tsaves: {\n\t\t'str': 0,\n\t\t'dex': 0,\n\t\t'con': 0,\n\t\t'intel': 0,\n\t\t'wis': 0,\n\t\t'cha': 0\n\t},\n\tskills: {\n\t\tacrobatics: 0,\n\t\tanimal_handling: 0,\n\t\tarcana: 0,\n\t\tathletics: 0,\n\t\tdeception: 0,\n\t\thistory: 0,\n\t\tinsight: 0,\n\t\tintimidation: 0,\n\t\tinvestigation: 0,\n\t\tmedicine: 0,\n\t\tnature: 0,\n\t\tperception: 0,\n\t\tperformance: 0,\n\t\tpersuasion: 0,\n\t\treligion: 0,\n\t\tsleight_of_Hand: 0,\n\t\tstealth: 0,\n\t\tsurvival: 0\n\t},\n\tweapons: '',\n\tproficiencies_other: '',\n\tlanguages: '',\n\ttraits: '',\n\tideals: '',\n\tbonds: '',\n\tflaws: '',\n\tequipment: '',\n\tcp: 0,\n\tsp: 0,\n\tgp: 0,\n\tpp: 0,\n\tfeatures: '',\n\tnotes: '',\n\tspell_ability: '',\n\tspell_save: '',\n\tspell_attack: '',\n\tspell_slots: {\n\t\t1: 0,\n\t\t2: 0,\n\t\t3: 0,\n\t\t4: 0,\n\t\t5: 0,\n\t\t6: 0,\n\t\t7: 0,\n\t\t8: 0,\n\t\t9: 0\n\t},\n\tspells: {\n\t\t0: '',\n\t\t1: '',\n\t\t2: '',\n\t\t3: '',\n\t\t4: '',\n\t\t5: '',\n\t\t6: '',\n\t\t7: '',\n\t\t8: '',\n\t\t9: ''\n\t},\n\tupdated: ''\n};\n\n/**\n * Storage:\n * Interface for localStorage\n */\nconst Storage = {\n\t/**\n\t * Returns blank or the value for the key\n\t * @param {String} key\n\t * @return {String}\n\t */\n\tget: function (key) {\n\t\tconst txt = localStorage.getItem(key);\n\t\treturn (txt !== null) ? txt : '';\n\t},\n\t/**\n\t * Store a value for the key\n\t * Warning: browsers vary for the amount of data you can store (usually ~5mb)\n\t * @param {String} key\n\t * @param {String} txt\n\t * @return {Boolean} returns false on error\n\t */\n\tset: function (key, txt) {\n\t\ttry {\n\t\t\tlocalStorage.setItem(key, txt);\n\t\t} catch (e) {\n\t\t\t// Should only happen when over quota\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\t/**\n\t * Remove a key\n\t * @param {String} key\n\t * @return void\n\t */\n\tremove: function (key) {\n\t\tlocalStorage.removeItem(key);\n\t},\n\t/**\n\t * Get an array of all keys\n\t * @return {Array}\n\t */\n\tgetAllKeys: function () {\n\t\tconst keys = [];\n\t\tif (localStorage.length > 0) {\n\t\t\tfor (let i = 0; i < localStorage.length; i++) {\n\t\t\t\tkeys.push(localStorage.key(i));\n\t\t\t}\n\t\t}\n\t\treturn keys;\n\t}\n};\n\n/**\n * If we save based on character name key then we have to account for name changes to change the localStorage key..\n */\n\n/**\n * Manager:\n * Interface for save/backup/restore of data...\n */\nconst Manager = exports.manager = {\n\t/**\n\t * Currently loaded character data is here\n\t */\n\tcur_character: null,\n\t/**\n\t * Get a json string as a character backup of the current character\n\t * In this way we make sure any new properties are included in the backup when saving\n\t * @return {String}\n\t */\n\tcharacterJSON: function () {\n\t\tconst obj = {};\n\t\tfor (const prop in this.cur_character) {\n\t\t\tobj[prop] = this.cur_character[prop];\n\t\t}\n\t\treturn JSON.stringify(obj);\n\t},\n\t/**\n\t * Return UTC datetime string for right now\n\t * @return {String}\n\t */\n\tcurrentTimestamp: function () {\n\t\tconst d = new Date();\n\t\treturn d.toUTCString();\n\t},\n\t/**\n\t * Generate a random key for character storage\n\t * @return {String}\n\t */\n\tgenerateKey: function () {\n\t\treturn (`${Math.random().toString(36)}00000000000000000`).slice(2, 9);\n\t},\n\t/**\n\t * Set data on character object\n\t */\n\tsetCurCharacterData: function (data) {\n\t\tif (typeof data !== 'object') { return; }\n\t\tconst props = Object.keys(data);\n\t\tprops.forEach((prop) => {\n\t\t\tif (typeof this.cur_character[prop] !== 'undefined') {\n\t\t\t\tthis.cur_character[prop] = data[prop];\n\t\t\t}\n\t\t});\n\t},\n\t/**\n\t * Change the character based on a hash change\n\t * or maybe I should process the event in the handler and pass it here if necessary...\n\t * @param {Object} e event object from hash change\n\t */\n\tchangeCharacter: function () {\n\t\tconst urlhash = window.location.hash.substr(1);\n\t\tconsole.log('changecharacter');\n\t\tthis.loadCharacter(urlhash);\n\t\tLoadMenu.close();\n\t},\n\t/**\n\t * Load character data based on a key\n\t * @param {String} key character identifier...????\n\t */\n\tloadCharacter: function (key) {\n\t\tconsole.log(`loadcharacter ${key}`);\n\t\tdialog_unsaved.classList.remove('open');\n\t\tconst json = Storage.get(key);\n\t\tif (json === '') {\n\t\t\tconsole.log('no character found');\n\t\t\t// prompt to load backup?\n\t\t\tthis.cur_character = Object.create(character_model);\n\t\t\tthis.cur_character.key = key;\n\t\t\tthis.renderCharacter();\n\t\t\treturn;\n\t\t}\n\t\tconst data = JSON.parse(json);\n\t\t\n\t\tthis.cur_character = Object.create(character_model);\n\t\tthis.setCurCharacterData(data);\n\t\tthis.renderCharacter();\n\t},\n\t/**\n\t * Take character data and fill it into the page\n\t */\n\trenderCharacter: function () {\n\t\tif (this.cur_character === null) { return; }\n\t\tconst fields = Array.from(document.querySelectorAll('*[data-name]'));\n\t\tfields.forEach((el) => {\n\t\t\tconst f = el.getAttribute('data-name');\n\t\t\tif (typeof this.cur_character[f] === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst subf = el.getAttribute('data-subfield');\n\t\t\tif (subf !== null) {\n\t\t\t\tif (typeof this.cur_character[f][subf] === 'undefined') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (typeof this.cur_character[f] !== 'undefined') {\n\t\t\t\tswitch (el.tagName) {\n\t\t\t\t\tcase 'INPUT':\n\t\t\t\t\tcase 'SELECT':\n\t\t\t\t\tcase 'TEXTAREA':\n\t\t\t\t\t\tif (el.getAttribute('type') === 'checkbox') {\n\t\t\t\t\t\t\tconst checked = (subf) ? this.cur_character[f][subf] : this.cur_character[f];\n\t\t\t\t\t\t\tif (checked === 1) {\n\t\t\t\t\t\t\t\tel.checked = true;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tel.checked = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tel.value = (subf) ? this.cur_character[f][subf] : this.cur_character[f];\n\t\t\t\t\t\tconst event = new Event('change');\n\t\t\t\t\t\tel.dispatchEvent(event);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tel.innerHTML = (subf) ? this.cur_character[f][subf] : this.cur_character[f];\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// Update attr/save/skill modifiers\n\t\tattribute_fields.forEach((el) => {\n\t\t\tconst field = el.parentNode;\n\t\t\tconst mod_field = field.querySelector('.pc-attribute-mod');\n\t\t\tmod_field.innerText = calcAttrMod(el.value);\n\t\t\tconst attr = el.getAttribute('data-name');\n\t\t\tcalcSaveMod(attr);\n\t\t\tconst skills = Array.from(document.querySelectorAll(`[data-attr=${attr}]`));\n\t\t\tskills.forEach((el) => {\n\t\t\t\tcalcSkillMod(el);\n\t\t\t});\n\t\t});\n\t\tdialog_unsaved.classList.remove('open');\n\t},\n\t/**\n\t * Save character data to localStorage\n\t */\n\tsaveCharacter: function () {\n\t\tconsole.log('save');\n\t\tif (this.cur_character === null) {\n\t\t\tthis.cur_character = Object.create(character_model);\n\t\t}\n\t\tconst fields = Array.from(document.querySelectorAll('*[data-name]'));\n\t\tfields.forEach((el) => {\n\t\t\tconst f = el.getAttribute('data-name');\n\t\t\tif (typeof this.cur_character[f] === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst subf = el.getAttribute('data-subfield');\n\t\t\tif (subf !== null) {\n\t\t\t\tif (typeof this.cur_character[f][subf] === 'undefined') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// for some reason trying to set the property of an object that is a property on the prototype\n\t\t\t\t// does not get the object to exist as an own property...\n\t\t\t\tif (!this.cur_character.hasOwnProperty(f)) {\n\t\t\t\t\tthis.cur_character[f] = character_model[f];\n\t\t\t\t}\n\t\t\t}\n\t\t\tswitch (el.tagName) {\n\t\t\t\tcase 'INPUT':\n\t\t\t\tcase 'SELECT':\n\t\t\t\tcase 'TEXTAREA':\n\t\t\t\t\tif (el.getAttribute('type') === 'checkbox') {\n\t\t\t\t\t\tconst checked = el.checked ? 1 : 0;\n\t\t\t\t\t\tif (subf) {\n\t\t\t\t\t\t\tthis.cur_character[f][subf] = checked;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.cur_character[f] = checked;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tif (subf) {\n\t\t\t\t\t\tthis.cur_character[f][subf] = el.value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cur_character[f] = el.value;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (subf) {\n\t\t\t\t\t\tthis.cur_character[f][subf] = el.innerHTML;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cur_character[f] = el.innerHTML;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t\tthis.cur_character.updated = this.currentTimestamp();\n\t\tStorage.set(this.cur_character.key, JSON.stringify(this.cur_character));\n\t\tdialog_unsaved.classList.remove('open');\n\t\tLoadMenu.addCharacter(this.cur_character.key);\n\t},\n\t/**\n\t * Save a file of the current character\n\t * Falls back to showing the data for copy/pasting\n\t */\n\tdownloadBackup: function () {\n\t\tconst data = this.characterJSON();\n\t\tif (typeof window.Blob !== 'function') {\n\t\t\t// fallback to displaying the data for copy/pasting\n\t\t\tconst content = [];\n\t\t\tconst p = document.createElement('p');\n\t\t\tp.innerHTML = `Your current browser/os does not support direct file downloads, so here is the data for you to copy/paste.`;\n\t\t\tconst text = document.createElement('textarea');\n\t\t\ttext.classList.add('large');\n\t\t\ttext.value = data;\n\t\t\tcontent.push(p);\n\t\t\tcontent.push(text);\n\t\t\tAlert.setContent(content);\n\t\t\ttext.focus();\n\t\t\ttext.select();\n\t\t\treturn;\n\t\t}\n\t\t// for env that support it, create a file for download\n\t\tconst a = document.createElement('a');\n\t\tconst file = new Blob([data], { type: 'application/json' });\n\t\tconst url = URL.createObjectURL(file);\n\t\ta.href = url;\n\t\ta.download = `character_${this.cur_character.charname}`;\n\t\tdocument.body.appendChild(a);\n\t\ta.click();\n\t\tsetTimeout(function () {\n\t\t\tdocument.body.removeChild(a);\n\t\t\twindow.URL.revokeObjectURL(url);\n\t\t}, 0);\n\t},\n\t/**\n\t * Open an email with the character data and instructions\n\t */\n\temailBackup: function () {\n\t\tconst data = this.characterJSON();\n\t\tconst body = `Below is the backup data for your character ${this.cur_character.charname}.\n\t\t\nTo use this data, go to: ${window.location.href} and click the \"Restore Backup\" button. Then paste the text below into the box.\n\t\t\n---\n\t\t\n${data}`;\n\t\t\n\t\tconst url = `mailto:?subject=${encodeURIComponent(`Character backup ${this.cur_character.charname}`)}&body=${encodeURIComponent(body)}`;\n\t\t\n\t\t// Sadly this simple solution doesn't work in iOS\n\t\t// document.location.href = url;\n\t\tconst content = [];\n\t\tconst a = document.createElement('a');\n\t\ta.href = url;\n\t\ta.innerHTML = 'Open new message in default email client';\n\t\ta.addEventListener('click', (e) => {\n\t\t\tAlert.clear();\n\t\t});\n\t\tcontent.push(a);\n\t\tAlert.setContent(content);\n\t},\n\t/**\n\t * Take json backup data and load the character\n\t * @param {String} data JSON data (we hope)\n\t */\n\trestoreCharacter: function (data) {\n\t\tconsole.log('restoreCharacter');\n\t\tdata = data.trim();\n\t\ttry {\n\t\t\t// convert linebreaks to html br else JSON.parse breaks\n\t\t\tdata = data.replace(/(?:\\r\\n|\\r|\\n)/g, '<br/>');\n\t\t\tconst char_obj = JSON.parse(data);\n\t\t\t// @todo somehow make sure we didnt end up with the same key for different characters (test against what?)\n\t\t\tif (!char_obj.key || char_obj.app !== 'character-sheet-5e') {\n\t\t\t\tthrow new Error('Data appears to be invalid.');\n\t\t\t}\n\t\t\tStorage.set(char_obj.key, data);\n\t\t\tLoadMenu.addCharacter(char_obj.key);\n\t\t\t// if its the current character we should reload them\n\t\t\tif (char_obj.key === this.cur_character.key) {\n\t\t\t\tthis.loadCharacter(char_obj.key);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconst p = document.createElement('p');\n\t\t\tp.innerHTML = `Error processing backup data: ${e.message}`;\n\t\t\tAlert.setContent(p);\n\t\t}\n\t},\n\t/**\n\t * Prompt to confirm deletion of character\n\t * @param {String} key character key\n\t */\n\tdeletePrompt: function (key) {\n\t\tlet data = Storage.get(key);\n\t\tif (data === '') {\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tdata = JSON.parse(data);\n\t\t} catch (e) {\n\t\t\treturn;\n\t\t}\n\t\tconst content = [];\n\t\tconst p = document.createElement('p');\n\t\tp.innerHTML = `Are you sure you want to delete the character: ${(data.charname) ? data.charname : '[Unnamed]'}`;\n\t\tcontent.push(p);\n\t\tconst btn = document.createElement('button');\n\t\tbtn.innerHTML = 'Yes, Delete.';\n\t\tbtn.setAttribute('data-key', data.key);\n\t\tbtn.classList.add('delete-conf');\n\t\tcontent.push(btn);\n\t\tAlert.setContent(content);\n\t},\n\t/**\n\t * Delete a character from local storage\n\t * @param {String} key character key\n\t */\n\tdeleteCharacter: function (key) {\n\t\tif (key === '' || key === 'settings') { return; }\n\t\tStorage.remove(key);\n\t\tif (Storage.get(key) !== '') {\n\t\t\t// error\n\t\t\tconst p = document.createElement('p');\n\t\t\tp.innerHTML = `Error deleting the character...`;\n\t\t\tAlert.setContent(p);\n\t\t} else {\n\t\t\t// success\n\t\t\t// remove from load list\n\t\t\tLoadMenu.removeCharacter(key);\n\t\t\t// if its the current character we should trigger \"new character\" action\n\t\t\tif (this.cur_character !== null && this.cur_character.key === key) {\n\t\t\t\twindow.location.hash = `#${Manager.generateKey()}`;\n\t\t\t}\n\t\t}\n\t}\n};\n\n/**\n * Load the saved characters into the dropdown\n */\nStorage.getAllKeys().forEach((key) => {\n\tLoadMenu.addCharacter(key);\n});\n\n/**\n * If there are no saved characters, display a first time user message\n */\nif (LoadMenu.isEmpty()) {\n\tconst content = [];\n\tconst h = document.createElement('h2');\n\th.innerHTML = 'Character Sheet. 5e.';\n\tcontent.push(h);\n\tconst p1 = document.createElement('p');\n\tp1.innerHTML = `An online character sheet for 5th edition D&D, usable offline (in some browsers).`;\n\tcontent.push(p1);\n\tconst p4 = document.createElement('p');\n\tp4.innerHTML = `Designed for modern browsers, if all else fails Chrome is your best bet and IE is your worst bet.`;\n\tcontent.push(p4);\n\tconst p2 = document.createElement('p');\n\tp2.innerHTML = `<strong>Warning:</strong> Character data is saved to your browser's local storage. This means it can be erased if you delete browser data and will not automatically transfer between browsers even on the same computer. Please Save and Backup often (or at least at the end of every gaming session)!`;\n\tcontent.push(p2);\n\tconst p3 = document.createElement('p');\n\tp3.innerHTML = `This message will only appear until you save your first character.`;\n\tcontent.push(p3);\n\tAlert.setContent(content);\n}\n\n/**\n * Event: Listen for hashchange and change the current character\n */\nwindow.addEventListener('hashchange', (e) => { Manager.changeCharacter(); }, false);\n\n/**\n * Check the hash to see if we need to load a specific character\n */\nconst urlhash = window.location.hash.substr(1);\nif (urlhash !== '') {\n\tManager.loadCharacter(urlhash);\n} else {\n\twindow.location.hash = `#${Manager.generateKey()}`;\n}\n\n/**\n * Help\n */\nconst dialog_help = document.getElementById('dialog_help');\nconst help_open = document.querySelector('.btn-help');\nhelp_open.addEventListener('click', (e) => {\n\tdialog_help.classList.add('open');\n\tdialog_help.querySelector('h1').focus();\n});\ndialog_help.querySelector('.close').addEventListener('click', (e) => {\n\tdialog_help.classList.remove('open');\n});\ndocument.body.addEventListener('click', (e) => {\n\tconst close = e.target.closest('#dialog_help');\n\tif (close === null) {\n\t\tif (e.target.classList.contains('btn-help')) { return; }\n\t\t// Hide the help.\n\t\tdialog_help.classList.remove('open');\n\t}\n});\n"]}