(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.charsheet = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";var character_model={app:"character-sheet-5e",key:"",charname:"",charclass:"",race:"",background:"",alignment:"",level:1,experience:0,inspiration:"",proficiency:"+2",armor_class:"",speed:30,hp_cur:"",hp_max:"",hd_cur:"",hd_max:"",str:10,dex:10,con:10,intel:10,wis:10,cha:10,saves:{str:0,dex:0,con:0,intel:0,wis:0,cha:0},skills:{acrobatics:0,animal_handling:0,arcana:0,athletics:0,deception:0,history:0,insight:0,intimidation:0,investigation:0,medicine:0,nature:0,perception:0,performance:0,persuasion:0,religion:0,sleight_of_Hand:0,stealth:0,survival:0},weapons:"",proficiencies_other:"",languages:"",traits:"",ideals:"",bonds:"",flaws:"",appearance:"",equipment:"",cp:"",sp:"",gp:"",pp:"",features:"",notes:"",spell_ability:"",spell_save:"",spell_attack:"",spell_slots:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},spells:{0:[],1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:""},updated:""},ui={attribute_fields:Array.from(document.querySelectorAll(".pc-attributes input[type=number]")),attribute_saves:Array.from(document.querySelectorAll(".pc-attributes input[type=checkbox]")),skill_checks:Array.from(document.querySelectorAll('input[data-name="skills"]')),dialog_unsaved:document.querySelector(".alert-unsaved"),spell_lists:Array.from(document.querySelectorAll("ul[data-name=spells]")),calcAttrMod:function(e){var t=Math.floor((e-10)/2);return t>0?"+"+t:t},calcSaveMod:function(e){var t=0,a=document.querySelector("[data-name="+e+"]").parentNode,r=a.querySelector(".pc-attribute-mod").innerHTML,n=a.querySelector(".pc-save-mod"),i=a.querySelector("input[type=checkbox]").checked;i&&(t=document.querySelector('[data-name="proficiency"]').innerHTML,t=""===t?0:parseInt(t,10));var c=0+parseInt(t,10)+parseInt(r,10);n.innerHTML=c>0?"+"+c:c},calcSkillMod:function(e){var t=e.checked,a=e.getAttribute("data-attr"),r=e.parentNode.nextElementSibling,n=0;t&&(n=document.querySelector('[data-name="proficiency"]').innerHTML,n=""===n?0:parseInt(n,10));var i=document.querySelector("[data-name="+a+"]"),c=parseInt(this.calcAttrMod(i.value),10),s=0+n+c;r.innerText=s>0?"+"+s:s},calcProfMod:function(){var e=this,t=document.querySelector("[data-name=proficiency]"),a=t.innerHTML,r=parseInt(document.querySelector("[data-name=level]").innerHTML,10),n=Math.ceil(r/4)+1,i="+"+n;a!==i&&(t.innerHTML="+"+n,this.attribute_fields.forEach(function(t){e.calcSaveMod(t.getAttribute("data-name"))}),this.skill_checks.forEach(function(t){e.calcSkillMod(t)}))},contentEditableFocus:function(e){"true"===e.target.getAttribute("contenteditable")&&e.target.setAttribute("data-before",e.target.innerHTML)},contentEditableBlur:function(e){if("true"===e.target.getAttribute("contenteditable")){var t=e.target.getAttribute("data-before"),a=e.target.innerHTML,r=a.trim();if(r=r.replace(/(<br\/?>)+$/,""),r!==a&&(e.target.innerHTML=r),t!==e.target.innerHTML){if(e.target.removeAttribute("data-before"),this.dialog_unsaved.classList.add("open"),"level"===e.target.getAttribute("data-name"))return void this.calcProfMod();if("spell_slots"===e.target.getAttribute("data-name")){var n=e.target.getAttribute("data-subfield"),i=parseInt(e.target.innerHTML,10),c=document.querySelector('[data-name="spells"][data-subfield="'+n+'"]');i?c.parentNode.classList.remove("hidden"):c.parentNode.classList.add("hidden")}}}},attributeChange:function(e){var t=this,a=e.target.parentNode,r=a.querySelector(".pc-attribute-mod");r.innerText=this.calcAttrMod(e.currentTarget.value);var n=e.target.getAttribute("data-name");this.calcSaveMod(n);var i=Array.from(document.querySelectorAll("[data-attr="+n+"]"));i.forEach(function(e){t.calcSkillMod(e)}),this.dialog_unsaved.classList.add("open")},saveChange:function(e){var t=e.currentTarget.getAttribute("data-subfield");this.calcSaveMod(t),this.dialog_unsaved.classList.add("open")},skillChange:function(e){this.calcSkillMod(e.currentTarget),this.dialog_unsaved.classList.add("open")},spellKeyPress:function(e){if(("LI"===e.target.tagName||e.target.closest("li"))&&13===e.which){e.preventDefault();var t=document.createElement("li");t.setAttribute("contenteditable","true"),e.currentTarget.appendChild(t),t.focus()}},postRender:function(){this.calcProfMod(),this.attribute_fields.forEach(function(e){var t=new Event("change");e.dispatchEvent(t)}),this.dialog_unsaved.classList.remove("open")},initialize:function(){var e=this;document.querySelector(".container").addEventListener("focus",this.contentEditableFocus.bind(this),!0),document.querySelector(".container").addEventListener("blur",this.contentEditableBlur.bind(this),!0),this.attribute_fields.forEach(function(t){t.addEventListener("change",e.attributeChange.bind(e))}),this.attribute_saves.forEach(function(t){t.addEventListener("change",e.saveChange.bind(e))}),this.skill_checks.forEach(function(t){t.addEventListener("change",e.skillChange.bind(e))}),this.spell_lists.forEach(function(t){t.addEventListener("keypress",e.spellKeyPress.bind(e))})}};module.exports={model:character_model,ui:ui};
},{}],2:[function(require,module,exports){
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Storage={prefix:"",setPrefix:function(e){this.prefix=e},get:function(e){var t=localStorage.getItem(""+this.prefix+e);return null===t&&(t=localStorage.getItem(e),null!==t&&this.set(e,t)),null!==t?t:""},set:function(e,t){try{localStorage.setItem(""+this.prefix+e,t),null!==localStorage.getItem(e)&&localStorage.removeItem(e)}catch(e){return!1}return!0},remove:function(e){localStorage.removeItem(""+this.prefix+e)},getAllKeys:function(){var e=[];if(localStorage.length>0)for(var t=new RegExp("^("+this.prefix+")+","i"),r=0;r<localStorage.length;r++){var a=localStorage.key(r);(0===a.indexOf(this.prefix)||a.match(/^[a-z0-9]{7}$/))&&(a=a.replace(t,""),e.push(a))}return e}},ActionMenu={el:null,opener:null,initialize:function(){var e=this;this.el=document.querySelector(".app-actions"),this.opener=document.querySelector(".btn-open-actions"),this.opener.addEventListener("click",function(t){e.el.classList.contains("open")&&(e.el.style.overflow="hidden"),e.el.classList.toggle("open")}),this.el.addEventListener("transitionend",function(t){var r=window.getComputedStyle(e.el);"0px"!==r.getPropertyValue("max-height")&&(e.el.style.overflow="visible")});var t=this.el.querySelector(".btn-file-backup");"function"!=typeof window.Blob&&(t.style.display="none"),t.addEventListener("click",function(e){Alert.setContent(div)});var r=this.el.querySelector(".btn-email-backup");r.addEventListener("click",function(e){Manager.emailBackup()});var a=this.el.querySelector(".btn-save");a.addEventListener("click",function(e){Manager.saveCharacter()});var n=this.el.querySelector(".btn-new-character");n.addEventListener("click",function(e){window.location.hash="#"+Manager.generateKey()});var c=this.el.querySelector(".btn-restore-backup");c.addEventListener("click",function(e){o.classList.add("open")});var i=this.el.querySelector(".btn-load");i.addEventListener("click",function(e){e.currentTarget.nextElementSibling.classList.toggle("open")});var o=document.querySelector(".dialog-backup");o.querySelector("button[type=button]").addEventListener("click",function(e){o.querySelector("form").reset(),o.classList.remove("open")}),o.querySelector("form").addEventListener("submit",function(e){e.preventDefault();var t=e.target.querySelector("input[type=file]");if(t.files&&t.files.length>0)Array.from(t.files).forEach(function(e){var t=new FileReader;t.onload=function(e){return function(e){Manager.restoreCharacter(e.target.result)}}(e),t.readAsText(e)});else{var r=e.target.querySelector("textarea");if(""===r.value)return;Manager.restoreCharacter(r.value)}o.classList.remove("open"),e.target.reset()})}},LoadMenu={el:document.querySelector("#character_list"),open:function(){this.el.classList.add("open")},close:function(){this.el.classList.remove("open")},addCharacter:function(e){if("undefined"!=typeof e&&""!==e)try{if("string"==typeof e&&(e=JSON.parse(e)),e.key&&""!==e.key){var t=this.el.querySelector('a[href="#'+e.key+'"]');if(null!==t)return void(t.textContent=e.charname+" ("+e.charclass+" "+e.level+")");var r=document.createElement("li"),a=document.createElement("a");a.textContent=e.charname+" ("+e.charclass+" "+e.level+")",a.setAttribute("href","#"+e.key),r.appendChild(a);var n=document.createElement("a");n.classList.add("delete"),n.innerHTML="‚ùå",n.setAttribute("href","#"),n.setAttribute("data-key",e.key),r.appendChild(n),this.el.querySelector("#saved_characters").appendChild(r)}}catch(e){console.log(e.message)}},removeCharacter:function(e){var t=this.el.querySelector('a[href="#'+e+'"]'),r=t.parentNode;r.parentNode.removeChild(r)},isEmpty:function(){return null===this.el.querySelector("li")},initialize:function(){var e=this;document.body.addEventListener("click",function(t){var r=t.target.closest("#"+e.el.id);if(null===r){if(t.target.classList.contains("btn-load"))return;e.close()}else t.target.classList.contains("delete")&&(t.preventDefault(),Manager.deletePrompt(t.target.getAttribute("data-key")),e.close())})}},Alert={el:document.querySelector(".alert-main"),setContent:function(e){Array.isArray(e)||(e=[e]),this.clear();var t=document.createDocumentFragment();e.forEach(function(e){t.appendChild(e)});var r=document.createElement("button");r.setAttribute("type","button"),r.classList.add("close"),r.textContent="Close",t.appendChild(r),this.el.appendChild(t),this.el.classList.add("open")},clear:function(){for(this.el.classList.remove("open");this.el.firstChild;)this.el.removeChild(this.el.firstChild)},initialize:function(){var e=this;this.el.addEventListener("click",function(t){if(t.target.classList.contains("close"))t.preventDefault(),e.clear();else if(t.target.classList.contains("delete-conf")){var r=t.target.getAttribute("data-key");e.clear(),Manager.deleteCharacter(r)}})}},HelpDialog={el:document.getElementById("dialog_help"),opener:document.querySelector(".btn-help"),closer:document.querySelector("#dialog_help .close"),initialize:function(){var e=this;this.opener.addEventListener("click",function(t){e.el.classList.add("open"),e.el.querySelector("h1").focus()}),this.closer.addEventListener("click",function(t){e.el.classList.remove("open")}),document.body.addEventListener("click",function(t){var r=t.target.closest("#dialog_help");if(null===r){if(t.target.classList.contains("btn-help"))return;e.el.classList.remove("open")}})}},Manager=module.exports={character_model:null,rules_ui:null,cur_character:null,dialog_unsaved:document.querySelector(".alert-unsaved"),characterJSON:function(){var e={};for(var t in this.cur_character)e[t]=this.cur_character[t];return JSON.stringify(e)},currentTimestamp:function(){var e=new Date;return e.toUTCString()},generateKey:function(){for(var e=(Math.random().toString(36)+"00000000000000000").slice(2,9);""!==Storage.get(e);)e=(Math.random().toString(36)+"00000000000000000").slice(2,9);return e},setCurCharacterData:function(e){var t=this;if("object"===("undefined"==typeof e?"undefined":_typeof(e))){var r=Object.keys(e);r.forEach(function(r){"undefined"!=typeof t.cur_character[r]&&(t.cur_character[r]=e[r])})}},changeCharacter:function(){var e=window.location.hash.substr(1);this.loadCharacter(e),LoadMenu.close()},loadCharacter:function(e){this.dialog_unsaved.classList.remove("open");var t=Storage.get(e);if(""===t)return this.cur_character=Object.create(this.character_model),this.cur_character.key=e,void this.renderCharacter();var r=JSON.parse(t);this.cur_character=Object.create(this.character_model),this.setCurCharacterData(r),this.renderCharacter()},renderCharacter:function(){var e=this;if(null!==this.cur_character){var t=Array.from(document.querySelectorAll("*[data-name]"));t.forEach(function(t){var r=t.getAttribute("data-name");if("undefined"!=typeof e.cur_character[r]){var a=t.getAttribute("data-subfield");null!==a&&"undefined"==typeof e.cur_character[r][a]||"undefined"!=typeof e.cur_character[r]&&!function(){switch(t.tagName){case"INPUT":case"SELECT":case"TEXTAREA":if("checkbox"===t.getAttribute("type")){var n=a?e.cur_character[r][a]:e.cur_character[r];1===n?t.checked=!0:t.checked=!1;break}t.value=a?e.cur_character[r][a]:e.cur_character[r];var c=new Event("change");t.dispatchEvent(c);break;case"UL":for(;t.firstChild;)t.removeChild(t.firstChild);var i=a?e.cur_character[r][a]:e.cur_character[r];Array.isArray(i)||(i=i.split(/;|<br\/?>/));var o=t.querySelector("li:empty");i.length>0&&i.forEach(function(e){if(""!==e){var r=document.createElement("li");r.setAttribute("contenteditable","true"),r.innerHTML=e,t.insertBefore(r,o)}});var s=document.createElement("li");s.setAttribute("contenteditable","true"),t.appendChild(s);break;default:t.innerHTML=a?e.cur_character[r][a]:e.cur_character[r];var l=new Event("blur");t.dispatchEvent(l)}}()}}),this.rules_ui.postRender()}},saveCharacter:function(){var e=this;null===this.cur_character&&(this.cur_character=Object.create(this.character_model));var t=Array.from(document.querySelectorAll("*[data-name]"));if(t.forEach(function(t){var r=t.getAttribute("data-name");if("undefined"!=typeof e.cur_character[r]){var a=t.getAttribute("data-subfield");if(null!==a){if("undefined"==typeof e.cur_character[r][a])return;e.cur_character.hasOwnProperty(r)||(e.cur_character[r]=e.character_model[r])}!function(){switch(t.tagName){case"INPUT":case"SELECT":case"TEXTAREA":if("checkbox"===t.getAttribute("type")){var n=t.checked?1:0;a?e.cur_character[r][a]=n:e.cur_character[r]=n;break}a?e.cur_character[r][a]=t.value:e.cur_character[r]=t.value;break;case"UL":var c=[],i=Array.from(t.querySelectorAll("li"));i.length>0&&i.forEach(function(e){var t=e.innerHTML;""!==t&&c.push(t)}),a?e.cur_character[r][a]=c:e.cur_character[r]=c;break;default:a?e.cur_character[r][a]=t.innerHTML:e.cur_character[r]=t.innerHTML}}()}}),""===this.cur_character.charname){var r=document.createElement("p");return r.innerHTML="Your character must have name to save!",void Alert.setContent(r)}this.cur_character.updated=this.currentTimestamp(),Storage.set(this.cur_character.key,JSON.stringify(this.cur_character)),this.dialog_unsaved.classList.remove("open"),LoadMenu.addCharacter(this.cur_character)},downloadBackup:function(){var e=this.characterJSON();if("function"!=typeof window.Blob){var t=[],r=document.createElement("p");r.innerHTML="Your current browser/os does not support direct file downloads, so here is the data for you to copy/paste.";var a=document.createElement("textarea");return a.classList.add("large"),a.value=e,t.push(r),t.push(a),Alert.setContent(t),a.focus(),void a.select()}var n=document.createElement("a"),c=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(c);n.href=i,n.download="character_"+this.cur_character.charname,document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),window.URL.revokeObjectURL(i)},0)},emailBackup:function(){var e=this.characterJSON(),t=new Date,r="Below is the backup data for your character "+this.cur_character.charname+".\n\t\t\nTo use this data, go to: "+window.location.href+' and click the "Restore Backup" button. Then paste the text below into the box.\n\t\t\n---\n\t\t\n'+e,a="mailto:?subject="+encodeURIComponent("Character backup "+this.cur_character.charname+" ("+t.toLocaleString()+")")+"&body="+encodeURIComponent(r),n=[],c=document.createElement("a");c.href=a,c.innerHTML="Open new message in default email client",c.addEventListener("click",function(e){Alert.clear()});var i=document.createElement("p");i.appendChild(c),n.push(i),Alert.setContent(n)},restoreCharacter:function(e){try{e=e.substring(e.indexOf("{")),e=e.substring(0,e.lastIndexOf("}")+1),e=e.trim(),e=e.replace(/(?:\r\n|\r|\n)/g,"<br/>");var t=JSON.parse(e);if(!t.key||"character-sheet-5e"!==t.app)throw new Error("Data appears to be invalid.");var r=Storage.get(t.key);if(""!==r&&""!==r.charname&&r.charname!==t.charname)if(t.key_prev){var a=t.key_prev;t.key_prev=t.key,t.key=a}else t.key_prev=t.key,t.key=this.generateKey();if(Storage.set(t.key,JSON.stringify(t)),LoadMenu.addCharacter(t),t.key===this.cur_character.key)this.loadCharacter(t.key);else{var n=document.createElement("p");n.textContent=t.charname+" has been added. ";var c=document.createElement("a");c.setAttribute("href","#"+t.key),c.textContent="View character now.",c.addEventListener("click",function(e){Alert.clear()}),n.appendChild(c),Alert.setContent(n)}}catch(e){var i=document.createElement("p");i.innerHTML="Error processing backup data: "+e.message,Alert.setContent(i)}},deletePrompt:function(e){var t=Storage.get(e);if(""!==t){try{t=JSON.parse(t)}catch(e){return}var r=[],a=document.createElement("p");a.innerHTML="Are you sure you want to delete the character: "+(t.charname?t.charname:"[Unnamed]"),r.push(a);var n=document.createElement("button");n.innerHTML="Yes, Delete.",n.setAttribute("data-key",t.key),n.classList.add("delete-conf"),r.push(n),Alert.setContent(r)}},deleteCharacter:function(e){if(""!==e&&"settings"!==e)if(Storage.remove(e),""!==Storage.get(e)){var t=document.createElement("p");t.innerHTML="Error deleting the character...",Alert.setContent(t)}else LoadMenu.removeCharacter(e),null!==this.cur_character&&this.cur_character.key===e&&(window.location.hash="#"+Manager.generateKey())},checkFeatures:function(){var e=!1;if("localStorage"in window&&null!==window.localStorage||(e=!0),e){var t=document.createElement("p");t.textContent="Sorry, your browser does not supported the required features for this app to work. Try using the latest Chrome or Firefox for best results.",Alert.setContent(t)}},checkCache:function(){if("applicationCache"in window){var e=function(e){var t=document.createElement("p");t.textContent="Character Sheet has been updated with new features or bug fixes. Please reload the page to get the newest code. If you have this site open in multiple tabs/windows please close them all.",Alert.setContent(t)};window.applicationCache.addEventListener("updateready",e,!1),window.applicationCache.status===window.applicationCache.UPDATEREADY&&e()}},showIntroDialog:function(){var e=[],t=document.createElement("h2");t.innerHTML="Character Sheet. 5e.",e.push(t);var r=document.createElement("p");r.innerHTML="An online character sheet for 5th edition D&D, usable offline (in some browsers).",e.push(r);var a=document.createElement("p");a.innerHTML="Designed for modern browsers, if all else fails Chrome is your best bet and IE is your worst bet.",e.push(a);var n=document.createElement("p");n.innerHTML="<strong>Warning:</strong> Character data is saved to your browser's local storage. This means it can be erased if you delete browser data and will not automatically transfer between browsers even on the same computer. Please Save and Backup often (or at least at the end of every gaming session)!",e.push(n);var c=document.createElement("p");c.innerHTML="This message will only appear until you save your first character.",e.push(c),Alert.setContent(e)},initialize:function(e){var t=this;if(!e.rules||!e.prefix)return void(document.body.innerHTML="<p>App is missing required settings.</p>");this.character_model=e.rules.model,this.rules_ui=e.rules.ui,Storage.setPrefix(e.prefix),Alert.initialize(),this.checkFeatures(),this.checkCache(),HelpDialog.initialize(),ActionMenu.initialize(),LoadMenu.initialize(this),Storage.getAllKeys().forEach(function(e){var t=Storage.get(e);LoadMenu.addCharacter(t)}),LoadMenu.isEmpty()&&this.showIntroDialog(),this.rules_ui.initialize(),window.addEventListener("hashchange",function(e){t.changeCharacter()},!1);var r=window.location.hash.substr(1);""!==r?this.loadCharacter(r):window.location.hash="#"+this.generateKey()}};
},{}],3:[function(require,module,exports){
"use strict";var rules=require("./Character5e.js"),Manager=require("./Manager.js");"serviceWorker"in navigator&&navigator.serviceWorker.register("service_worker.js",{scope:"/"}),Manager.initialize({rules:rules,prefix:"charsheet-5e-"});
},{"./Character5e.js":1,"./Manager.js":2}]},{},[3])(3)
});


//# sourceMappingURL=main.js.map