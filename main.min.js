(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.charsheet = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},checkFeatures=function(){if(!("localStorage"in window&&null!==window.localStorage))return!1};"serviceWorker"in navigator&&navigator.serviceWorker.register("service_worker.js",{scope:"/"});var Alert={el:document.querySelector(".alert-main"),setContent:function(e){Array.isArray(e)||(e=[e]),this.clear();var t=document.createDocumentFragment();e.forEach(function(e){t.appendChild(e)});var a=document.createElement("button");a.setAttribute("type","button"),a.classList.add("close"),a.textContent="Close",t.appendChild(a),this.el.appendChild(t),this.el.classList.add("open")},clear:function(){for(this.el.classList.remove("open");this.el.firstChild;)this.el.removeChild(this.el.firstChild)},initialize:function(){var e=this;this.el.addEventListener("click",function(t){if(t.target.classList.contains("close"))t.preventDefault(),e.clear();else if(t.target.classList.contains("delete-conf")){var a=t.target.getAttribute("data-key");e.clear(),Manager.deleteCharacter(a)}})}};if(Alert.initialize(),checkFeatures()===!1){var p=document.createElement("p");p.textContent="Sorry, your browser does not supported the required features for this app to work. Try using the latest Chrome or Firefox for best results.",Alert.setContent(p)}if("applicationCache"in window){var updateAppCache=function(e){var t=document.createElement("p");t.textContent="Character Sheet has been updated with new features or bug fixes. Please reload the page to get the newest code. If you have this site open in multiple tabs/windows please close them all.",Alert.setContent(t)};window.applicationCache.addEventListener("updateready",updateAppCache,!1),window.applicationCache.status===window.applicationCache.UPDATEREADY&&updateAppCache()}var backup_dialog=document.querySelector(".dialog-backup");backup_dialog.querySelector("button[type=button]").addEventListener("click",function(e){backup_dialog.querySelector("form").reset(),backup_dialog.classList.remove("open")}),backup_dialog.querySelector("form").addEventListener("submit",function(e){e.preventDefault();var t=e.target.querySelector("input[type=file]");if(t.files&&t.files.length>0)Array.from(t.files).forEach(function(e){var t=new FileReader;t.onload=function(e){return function(e){Manager.restoreCharacter(e.target.result)}}(e),t.readAsText(e)});else{var a=e.target.querySelector("textarea");if(""===a.value)return;Manager.restoreCharacter(a.value)}backup_dialog.classList.remove("open"),e.target.reset()});var action_menu=document.querySelector(".app-actions"),action_opener=document.querySelector(".btn-open-actions");action_opener.addEventListener("click",function(e){action_menu.classList.contains("open")&&(action_menu.style.overflow="hidden"),action_menu.classList.toggle("open")}),action_menu.addEventListener("transitionend",function(e){var t=window.getComputedStyle(action_menu);"0px"!==t.getPropertyValue("max-height")&&(action_menu.style.overflow="visible")});var action_btn_backup=action_menu.querySelector(".btn-file-backup");"function"!=typeof window.Blob&&(action_btn_backup.style.display="none"),action_btn_backup.addEventListener("click",function(e){Manager.downloadBackup()});var action_btn_email=action_menu.querySelector(".btn-email-backup");action_btn_email.addEventListener("click",function(e){Manager.emailBackup()});var action_btn_save=action_menu.querySelector(".btn-save");action_btn_save.addEventListener("click",function(e){Manager.saveCharacter()});var action_btn_new=action_menu.querySelector(".btn-new-character");action_btn_new.addEventListener("click",function(e){window.location.hash="#"+Manager.generateKey()});var action_btn_restore=action_menu.querySelector(".btn-restore-backup");action_btn_restore.addEventListener("click",function(e){backup_dialog.classList.add("open")});var action_btn_load=action_menu.querySelector(".btn-load");action_btn_load.addEventListener("click",function(e){e.currentTarget.nextElementSibling.classList.toggle("open")});var LoadMenu={el:document.querySelector("#character_list"),open:function(){this.el.classList.add("open")},close:function(){this.el.classList.remove("open")},addCharacter:function(e){var t=Storage.get(e);if(""!==t)try{if(t=JSON.parse(t),t.key&&""!==t.key){var a=this.el.querySelector('a[href="#'+t.key+'"]');if(null!==a)return void(a.textContent=t.charname+" ("+t.charclass+" "+t.level+")");var r=document.createElement("li"),n=document.createElement("a");n.textContent=t.charname+" ("+t.charclass+" "+t.level+")",n.setAttribute("href","#"+t.key),r.appendChild(n);var c=document.createElement("a");c.classList.add("delete"),c.innerHTML="❌",c.setAttribute("href","#"),c.setAttribute("data-key",t.key),r.appendChild(c),this.el.querySelector("#saved_characters").appendChild(r)}}catch(e){console.log(e.message)}},removeCharacter:function(e){var t=this.el.querySelector('a[href="#'+e+'"]'),a=t.parentNode;a.parentNode.removeChild(a)},isEmpty:function(){return null===this.el.querySelector("li")},initialize:function(){var e=this;document.body.addEventListener("click",function(t){var a=t.target.closest("#"+e.el.id);if(null===a){if(t.target.classList.contains("btn-load"))return;e.close()}else t.target.classList.contains("delete")&&(t.preventDefault(),Manager.deletePrompt(t.target.getAttribute("data-key")),e.close())})}};LoadMenu.initialize();var attribute_fields=Array.from(document.querySelectorAll(".pc-attributes input[type=number]")),attribute_saves=Array.from(document.querySelectorAll(".pc-attributes input[type=checkbox]")),skill_checks=Array.from(document.querySelectorAll('input[data-name="skills"]')),dialog_unsaved=document.querySelector(".alert-unsaved"),calcAttrMod=function(e){var t=Math.floor((e-10)/2);return t>0?"+"+t:t},calcSaveMod=function(e){var t=0,a=document.querySelector("[data-name="+e+"]").parentNode,r=a.querySelector(".pc-attribute-mod").innerHTML,n=a.querySelector(".pc-save-mod"),c=a.querySelector("input[type=checkbox]").checked;c&&(t=document.querySelector('[data-name="proficiency"]').innerHTML,t=""===t?0:parseInt(t,10));var o=0+parseInt(t,10)+parseInt(r,10);n.innerHTML=o>0?"+"+o:o},calcSkillMod=function(e){var t=e.checked,a=e.getAttribute("data-attr"),r=e.parentNode.nextElementSibling,n=0;t&&(n=document.querySelector('[data-name="proficiency"]').innerHTML,n=""===n?0:parseInt(n,10));var c=document.querySelector("[data-name="+a+"]"),o=parseInt(calcAttrMod(c.value),10),i=0+n+o;r.innerText=i>0?"+"+i:i},calcProfMod=function(){var e=document.querySelector("[data-name=proficiency]"),t=e.innerHTML,a=parseInt(document.querySelector("[data-name=level]").innerHTML,10),r=Math.ceil(a/4)+1,n="+"+r;if(t!==n){e.innerHTML="+"+r;var c=Array.from(document.querySelectorAll(".pc-attributes input[type=number]"));c.forEach(function(e){calcSaveMod(e.getAttribute("data-name"))});var o=Array.from(document.querySelectorAll('input[data-name="skills"]'));o.forEach(function(e){calcSkillMod(e)})}};document.querySelector(".container").addEventListener("focus",function(e){"true"===e.target.getAttribute("contenteditable")&&e.target.setAttribute("data-before",e.target.innerHTML)},!0),document.querySelector(".container").addEventListener("blur",function(e){if("true"===e.target.getAttribute("contenteditable")){var t=e.target.getAttribute("data-before");t!==e.target.innerHTML&&(e.target.removeAttribute("data-before"),dialog_unsaved.classList.add("open"),"level"===e.target.getAttribute("data-name")&&calcProfMod())}},!0),attribute_fields.forEach(function(e){var t=e.parentNode,a=t.querySelector(".pc-attribute-mod");e.addEventListener("change",function(t){a.innerText=calcAttrMod(t.currentTarget.value);var r=e.getAttribute("data-name");calcSaveMod(r);var n=Array.from(document.querySelectorAll("[data-attr="+r+"]"));n.forEach(function(e){calcSkillMod(e)}),dialog_unsaved.classList.add("open")})}),attribute_saves.forEach(function(e){e.addEventListener("change",function(e){var t=e.currentTarget.getAttribute("data-subfield");calcSaveMod(t),dialog_unsaved.classList.add("open")})}),skill_checks.forEach(function(e){e.addEventListener("change",function(e){calcSkillMod(e.currentTarget),dialog_unsaved.classList.add("open")})});var character_model={app:"character-sheet-5e",key:"",charname:"",charclass:"",race:"",background:"",alignment:"",level:1,experience:0,inspiration:"",proficiency:"+2",armor_class:10,speed:30,hp_cur:0,hp_max:0,hd_cur:1,hd_max:1,str:10,dex:10,con:10,intel:10,wis:10,cha:10,saves:{str:0,dex:0,con:0,intel:0,wis:0,cha:0},skills:{acrobatics:0,animal_handling:0,arcana:0,athletics:0,deception:0,history:0,insight:0,intimidation:0,investigation:0,medicine:0,nature:0,perception:0,performance:0,persuasion:0,religion:0,sleight_of_Hand:0,stealth:0,survival:0},weapons:"",proficiencies_other:"",languages:"",traits:"",ideals:"",bonds:"",flaws:"",appearance:"",equipment:"",cp:0,sp:0,gp:0,pp:0,features:"",notes:"",spell_ability:"",spell_save:"",spell_attack:"",spell_slots:{1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},spells:{0:"",1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:""},updated:""},Storage={prefix:"",setPrefix:function(e){this.prefix=e},get:function(e){var t=localStorage.getItem(""+this.prefix+e);return null===t&&(t=localStorage.getItem(e),null!==t&&this.set(e,t)),null!==t?t:""},set:function(e,t){try{localStorage.setItem(""+this.prefix+e,t),null!==localStorage.getItem(e)&&localStorage.removeItem(e)}catch(e){return!1}return!0},remove:function(e){localStorage.removeItem(""+this.prefix+e)},getAllKeys:function(){var e=[];if(localStorage.length>0)for(var t=new RegExp("^("+this.prefix+")+","i"),a=0;a<localStorage.length;a++){var r=localStorage.key(a);(0===r.indexOf(this.prefix)||r.match(/^[a-z0-9]{7}$/))&&(r=r.replace(t,""),e.push(r))}return e}};Storage.setPrefix("charsheet-5e-");var Manager=exports.manager={cur_character:null,characterJSON:function(){var e={};for(var t in this.cur_character)e[t]=this.cur_character[t];return JSON.stringify(e)},currentTimestamp:function(){var e=new Date;return e.toUTCString()},generateKey:function(){for(var e=(Math.random().toString(36)+"00000000000000000").slice(2,9);""!==Storage.get(e);)e=(Math.random().toString(36)+"00000000000000000").slice(2,9);return e},setCurCharacterData:function(e){var t=this;if("object"===("undefined"==typeof e?"undefined":_typeof(e))){var a=Object.keys(e);a.forEach(function(a){"undefined"!=typeof t.cur_character[a]&&(t.cur_character[a]=e[a])})}},changeCharacter:function(){var e=window.location.hash.substr(1);this.loadCharacter(e),LoadMenu.close()},loadCharacter:function(e){dialog_unsaved.classList.remove("open");var t=Storage.get(e);if(""===t)return this.cur_character=Object.create(character_model),this.cur_character.key=e,void this.renderCharacter();var a=JSON.parse(t);this.cur_character=Object.create(character_model),this.setCurCharacterData(a),this.renderCharacter()},renderCharacter:function(){var e=this;if(null!==this.cur_character){var t=Array.from(document.querySelectorAll("*[data-name]"));t.forEach(function(t){var a=t.getAttribute("data-name");if("undefined"!=typeof e.cur_character[a]){var r=t.getAttribute("data-subfield");if((null===r||"undefined"!=typeof e.cur_character[a][r])&&"undefined"!=typeof e.cur_character[a])switch(t.tagName){case"INPUT":case"SELECT":case"TEXTAREA":if("checkbox"===t.getAttribute("type")){var n=r?e.cur_character[a][r]:e.cur_character[a];1===n?t.checked=!0:t.checked=!1;break}t.value=r?e.cur_character[a][r]:e.cur_character[a];var c=new Event("change");t.dispatchEvent(c);break;default:t.innerHTML=r?e.cur_character[a][r]:e.cur_character[a]}}}),calcProfMod(),attribute_fields.forEach(function(e){var t=e.parentNode,a=t.querySelector(".pc-attribute-mod");a.innerText=calcAttrMod(e.value);var r=e.getAttribute("data-name");calcSaveMod(r);var n=Array.from(document.querySelectorAll("[data-attr="+r+"]"));n.forEach(function(e){calcSkillMod(e)})}),dialog_unsaved.classList.remove("open")}},saveCharacter:function(){var e=this;null===this.cur_character&&(this.cur_character=Object.create(character_model));var t=Array.from(document.querySelectorAll("*[data-name]"));if(t.forEach(function(t){var a=t.getAttribute("data-name");if("undefined"!=typeof e.cur_character[a]){var r=t.getAttribute("data-subfield");if(null!==r){if("undefined"==typeof e.cur_character[a][r])return;e.cur_character.hasOwnProperty(a)||(e.cur_character[a]=character_model[a])}switch(t.tagName){case"INPUT":case"SELECT":case"TEXTAREA":if("checkbox"===t.getAttribute("type")){var n=t.checked?1:0;r?e.cur_character[a][r]=n:e.cur_character[a]=n;break}r?e.cur_character[a][r]=t.value:e.cur_character[a]=t.value;break;default:r?e.cur_character[a][r]=t.innerHTML:e.cur_character[a]=t.innerHTML}}}),""===this.cur_character.charname){var a=document.createElement("p");return a.innerHTML="Your character must have name to save!",void Alert.setContent(a)}this.cur_character.updated=this.currentTimestamp(),Storage.set(this.cur_character.key,JSON.stringify(this.cur_character)),dialog_unsaved.classList.remove("open"),LoadMenu.addCharacter(this.cur_character.key)},downloadBackup:function(){var e=this.characterJSON();if("function"!=typeof window.Blob){var t=[],a=document.createElement("p");a.innerHTML="Your current browser/os does not support direct file downloads, so here is the data for you to copy/paste.";var r=document.createElement("textarea");return r.classList.add("large"),r.value=e,t.push(a),t.push(r),Alert.setContent(t),r.focus(),void r.select()}var n=document.createElement("a"),c=new Blob([e],{type:"application/json"}),o=URL.createObjectURL(c);n.href=o,n.download="character_"+this.cur_character.charname,document.body.appendChild(n),n.click(),setTimeout(function(){document.body.removeChild(n),window.URL.revokeObjectURL(o)},0)},emailBackup:function(){var e=this.characterJSON(),t="Below is the backup data for your character "+this.cur_character.charname+".\n\t\t\nTo use this data, go to: "+window.location.href+' and click the "Restore Backup" button. Then paste the text below into the box.\n\t\t\n---\n\t\t\n'+e,a="mailto:?subject="+encodeURIComponent("Character backup "+this.cur_character.charname)+"&body="+encodeURIComponent(t),r=[],n=document.createElement("a");n.href=a,n.innerHTML="Open new message in default email client",n.addEventListener("click",function(e){Alert.clear()});var c=document.createElement("p");c.appendChild(n),r.push(c),Alert.setContent(r)},restoreCharacter:function(e){try{e=e.substring(e.indexOf("{")),e=e.substring(0,e.lastIndexOf("}")+1),e=e.trim(),e=e.replace(/(?:\r\n|\r|\n)/g,"<br/>");var t=JSON.parse(e);if(!t.key||"character-sheet-5e"!==t.app)throw new Error("Data appears to be invalid.");var a=Storage.get(t.key);if(""!==a&&""!==a.charname&&a.charname!==t.charname)if(t.key_prev){var r=t.key_prev;t.key_prev=t.key,t.key=r}else t.key_prev=t.key,t.key=this.generateKey();Storage.set(t.key,JSON.stringify(t)),LoadMenu.addCharacter(t.key),t.key===this.cur_character.key&&this.loadCharacter(t.key)}catch(e){var n=document.createElement("p");n.innerHTML="Error processing backup data: "+e.message,Alert.setContent(n)}},deletePrompt:function(e){var t=Storage.get(e);if(""!==t){try{t=JSON.parse(t)}catch(e){return}var a=[],r=document.createElement("p");r.innerHTML="Are you sure you want to delete the character: "+(t.charname?t.charname:"[Unnamed]"),a.push(r);var n=document.createElement("button");n.innerHTML="Yes, Delete.",n.setAttribute("data-key",t.key),n.classList.add("delete-conf"),a.push(n),Alert.setContent(a)}},deleteCharacter:function(e){if(""!==e&&"settings"!==e)if(Storage.remove(e),""!==Storage.get(e)){var t=document.createElement("p");t.innerHTML="Error deleting the character...",Alert.setContent(t)}else LoadMenu.removeCharacter(e),null!==this.cur_character&&this.cur_character.key===e&&(window.location.hash="#"+Manager.generateKey())}};if(Storage.getAllKeys().forEach(function(e){LoadMenu.addCharacter(e)}),LoadMenu.isEmpty()){var content=[],h=document.createElement("h2");h.innerHTML="Character Sheet. 5e.",content.push(h);var p1=document.createElement("p");p1.innerHTML="An online character sheet for 5th edition D&D, usable offline (in some browsers).",content.push(p1);var p4=document.createElement("p");p4.innerHTML="Designed for modern browsers, if all else fails Chrome is your best bet and IE is your worst bet.",content.push(p4);var p2=document.createElement("p");p2.innerHTML="<strong>Warning:</strong> Character data is saved to your browser's local storage. This means it can be erased if you delete browser data and will not automatically transfer between browsers even on the same computer. Please Save and Backup often (or at least at the end of every gaming session)!",content.push(p2);var p3=document.createElement("p");p3.innerHTML="This message will only appear until you save your first character.",content.push(p3),Alert.setContent(content)}window.addEventListener("hashchange",function(e){Manager.changeCharacter()},!1);var urlhash=window.location.hash.substr(1);""!==urlhash?Manager.loadCharacter(urlhash):window.location.hash="#"+Manager.generateKey();var dialog_help=document.getElementById("dialog_help"),help_open=document.querySelector(".btn-help");help_open.addEventListener("click",function(e){dialog_help.classList.add("open"),dialog_help.querySelector("h1").focus()}),dialog_help.querySelector(".close").addEventListener("click",function(e){dialog_help.classList.remove("open")}),document.body.addEventListener("click",function(e){var t=e.target.closest("#dialog_help");if(null===t){if(e.target.classList.contains("btn-help"))return;dialog_help.classList.remove("open")}});
},{}]},{},[1])(1)
});


//# sourceMappingURL=main.js.map